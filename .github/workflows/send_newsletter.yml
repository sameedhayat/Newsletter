name: ðŸš€ Send AI-Agent Newsletter

on:
  schedule:
    - cron:  '0 8 * * MON'
  workflow_dispatch:

jobs:
  send_newsletter:
    runs-on: ubuntu-latest
    steps:
      - name: Check out code
        uses: actions/checkout@v4

      - name: Set up Miniconda
        uses: conda-incubator/setup-miniconda@v2
        with:
          auto-activate-base: false
          python-version: 3.11
          environment-file: environment.yml
          activate-environment: ai-agent-newsletter

      - name: Verify environment
        run: |
          conda info
          conda list

      - name: Fetch & send newsletter
        run: python main.py "AI Agent"
        env:
          SMTP_HOST:       ${{ secrets.SMTP_HOST }}
          SMTP_PORT:       ${{ secrets.SMTP_PORT }}
          SMTP_USER:       ${{ secrets.SMTP_USER }}
          SMTP_PASS:       ${{ secrets.SMTP_PASS }}
          EMAIL_SENDER:    ${{ secrets.EMAIL_SENDER }}
          EMAIL_RECIPIENT: ${{ secrets.EMAIL_RECIPIENT }}
          OPENAI_API_KEY:  ${{ secrets.OPENAI_API_KEY }}
          NEWS_API_KEY:    ${{ secrets.NEWS_API_KEY }}
          TWIKIT_USERNAME: ${{ secrets.TWIKIT_USERNAME }}
          TWIKIT_EMAIL:    ${{ secrets.TWIKIT_EMAIL }}
          TWIKIT_PASSWORD: ${{ secrets.TWIKIT_PASSWORD }}